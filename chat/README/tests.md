# Тесты приложения Chat

## Тесты представлений (test_views.py)

### ChatTest
Базовая настройка для всех тестов:
- Создание тестовых пользователей (покупатель, продавец)
- Создание тестовой категории и продукта
- Создание тестового диалога

#### Что тестируем:

##### 1. Список диалогов (`test_dialogs_list`)
```python
def test_dialogs_list(self):
    response = self.client.get(reverse('chat:dialogs_list'))
    self.assertEqual(response.status_code, 200)
```
- Проверяем доступность страницы со списком диалогов
- Проверяем использование правильного шаблона

##### 2. Детали диалога (`test_dialog_detail`)
- Проверка доступа к странице диалога
- Проверка отображения сообщений
- Проверка шаблона

##### 3. Отправка сообщений (`test_send_message`)
- Создание нового сообщения через POST-запрос
- Проверка сохранения сообщения в базе
- Проверка корректности данных сообщения

##### 4. Создание диалога (`test_create_dialog`)
- Создание нового диалога между пользователями
- Проверка добавления участников
- Проверка редиректа после создания

##### 5. Права доступа (`test_dialog_access_permissions`)
- Попытка доступа неавторизованного пользователя
- Попытка доступа пользователя не из диалога
- Проверка запрета отправки сообщений

##### 6. Статус прочтения (`test_message_read_status`)
- Отправка сообщения продавцом
- Проверка статуса непрочитанного сообщения
- Проверка обновления статуса после прочтения

##### 7. Порядок сообщений (`test_messages_ordering`)
- Создание нескольких сообщений
- Проверка правильного порядка в выдаче
- Проверка сортировки по времени

##### 8. Ограничения создания диалогов (`test_dialog_creation_restrictions`)
- Попытка создать дублирующий диалог
- Попытка создать диалог с самим собой
- Проверка корректных сообщений об ошибках

## Тесты WebSocket (test_consumers.py)

### ChatConsumerTest
Тесты для WebSocket соединений:

#### 1. Подключение
- Успешное подключение к диалогу
- Отказ в доступе для неавторизованных
- Проверка группы чата

#### 2. Отправка сообщений
- Отправка текстовых сообщений
- Статусы "печатает"
- Уведомления о прочтении

#### 3. Статусы пользователей
- Онлайн статус при подключении
- Оффлайн статус при отключении
- Обновление времени последней активности

## Тесты аудио (test_audio.py)

### AudioMessageProcessorTest
Тесты обработки аудиосообщений:

#### 1. Обработка аудио
- Загрузка аудиофайла
- Улучшение качества
- Генерация волновой формы

#### 2. Шумоподавление
- Удаление фонового шума
- Сохранение качества голоса
- Проверка уровня шума

#### 3. Транскрибация
- Конвертация речи в текст
- Обработка разных языков
- Обработка ошибок распознавания

## Как запускать тесты

### Все тесты приложения
```bash
python manage.py test chat
```

### Конкретный класс тестов
```bash
python manage.py test chat.tests.ChatTest
```

### Конкретный тест
```bash
python manage.py test chat.tests.ChatTest.test_send_message
``` 