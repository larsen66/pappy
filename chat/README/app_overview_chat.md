# Что мы сделали в приложении Chat

## Наши модели

### Dialog (Диалог)
Основная модель для личных сообщений между двумя пользователями:
- `participants` - участники диалога (ManyToMany с User)
- `announcement` - связанное объявление (опционально)
- `created` - дата создания
- `updated` - дата обновления

Менеджер `DialogManager` помогает создавать диалоги между пользователями:
```python
dialog, created = Dialog.objects.get_or_create_for_users(user1, user2, announcement)
```

### Chat (Групповой чат)
Модель для групповых чатов:
- `participants` - участники чата
- `created_at` - дата создания
- `updated_at` - дата обновления

### Message (Сообщение)
Модель для хранения сообщений:
- `chat` - связь с чатом
- `sender` - отправитель
- `text` - текст сообщения
- `created_at` - время отправки
- `is_read` - статус прочтения

## Что умеет наше приложение

### WebSocket соединения
Мы используем Django Channels для реализации WebSocket:
- Мгновенная доставка сообщений
- Статусы "печатает"
- Онлайн/оффлайн статусы
- Уведомления о прочтении

### Обработка аудиосообщений
Класс `AudioMessageProcessor`:
- Улучшение качества аудио
- Шумоподавление
- Генерация визуальной волны
- Транскрибация в текст

### Основные функции

#### Для диалогов:
- Создание диалогов между пользователями
- Отправка текстовых сообщений
- Отправка файлов и изображений
- Просмотр списка диалогов
- Получение новых сообщений
- Отметка о прочтении

#### Для групповых чатов:
- Создание групповых чатов
- Управление участниками
- Групповые сообщения
- Уведомления для всех участников

## API Endpoints

### Диалоги
- `GET /chat/` - список диалогов
- `GET /chat/<int:chat_id>/` - детали диалога
- `POST /chat/create/<int:user_id>/` - создание диалога

### WebSocket URLs
- `ws/chat/<dialog_id>/` - WebSocket для личных диалогов
- `ws/group-chat/<chat_id>/` - WebSocket для групповых чатов

## Административный интерфейс

### ChatAdmin
- Просмотр списка чатов
- Фильтрация по дате создания
- Поиск по участникам

### MessageAdmin
- Просмотр всех сообщений
- Фильтрация по чатам и статусу
- Быстрые действия для отметки сообщений
- Защита от изменения сообщений

## Безопасность
- Проверка прав доступа к диалогам
- Защита от создания дублирующих диалогов
- Валидация входящих сообщений
- Ограничение доступа к чужим диалогам

## Особенности реализации
- Асинхронная обработка WebSocket соединений
- Оптимизированные запросы к базе данных
- Кэширование списков диалогов
- Эффективная обработка статусов сообщений 