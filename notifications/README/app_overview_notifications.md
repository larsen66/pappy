# Обзор приложения Notifications

## Модели

### NotificationPreference (Настройки уведомлений)
Настройки уведомлений пользователя:
- Email уведомления:
  - Новые совпадения
  - Новые сообщения
  - Обновления статуса
  - Новые рекомендации
  - Потерянные животные
- Push уведомления:
  - Аналогичные настройки для push
- Частота уведомлений:
  - instant (Мгновенно)
  - daily (Раз в день)
  - weekly (Раз в неделю)
- Тихие часы:
  - Время начала
  - Время окончания
- Геолокация:
  - Радиус для уведомлений о потерянных животных

### Notification (Уведомление)
Модель уведомления:
- Типы уведомлений:
  - match (Новое совпадение)
  - message (Новое сообщение)
  - status_update (Обновление статуса)
  - recommendation (Рекомендация)
  - lost_pet (Потерянное животное)
  - system (Системное уведомление)
- Связь с пользователем
- Заголовок и сообщение
- Связь с объектом через ContentType
- Метаданные:
  - Время создания
  - Время прочтения
  - Статус прочтения
- Статус отправки:
  - Email отправлен
  - Push отправлен

### NotificationBatch (Пакет уведомлений)
Группировка уведомлений для отложенной отправки:
- Связь с пользователем
- Список уведомлений
- Частота отправки (daily/weekly)
- Время планирования
- Статус отправки

### PushToken (Push-токен)
Хранение push-токенов устройств:
- Связь с пользователем
- Токен устройства
- Тип устройства (iOS/Android/Web)
- Статус активности
- Метки времени

## Сервисы

### NotificationService
Основной сервис уведомлений:

1. Создание уведомлений:
   - Проверка настроек пользователя
   - Учет тихого режима
   - Выбор способа доставки

2. Отправка уведомлений:
   - Email уведомления с шаблонами
   - Push уведомления через Firebase
   - Группировка для отложенной отправки

3. Управление уведомлениями:
   - Отметка о прочтении
   - Подсчет непрочитанных
   - Управление push-токенами

4. Пакетная обработка:
   - Группировка по типам
   - Отложенная отправка
   - Обработка очереди

## Представления

### Основные представления:
1. Список уведомлений:
   - Фильтрация по типу
   - Фильтрация по статусу
   - Пагинация (20 на страницу)

2. Настройки уведомлений:
   - Форма настроек
   - Валидация данных
   - Сохранение предпочтений

3. Управление уведомлениями:
   - Отметка о прочтении
   - Массовая отметка
   - Удаление уведомлений

4. Push-токены:
   - Регистрация токенов
   - Отключение токенов
   - Обработка ошибок

## Формы

### NotificationPreferenceForm
Форма настроек уведомлений:
- Выбор типов уведомлений
- Настройка частоты
- Настройка тихих часов
- Настройка радиуса
- Валидация данных:
  - Проверка включенных типов
  - Валидация времени
  - Проверка радиуса

## Административный интерфейс

### NotificationAdmin
Управление уведомлениями:
- Отображение:
  - Пользователь
  - Тип уведомления
  - Заголовок
  - Статус прочтения
  - Время создания
- Фильтрация и поиск
- Массовые действия:
  - Отметка как прочитанные
  - Отметка как непрочитанные

## Контекстные процессоры
- Добавление счетчика непрочитанных уведомлений в контекст шаблонов

## URL-маршруты
- Список уведомлений
- Настройки уведомлений
- Управление статусом
- Работа с push-токенами
- Детали уведомления
- API для счетчиков

## Ключевые особенности

### Гибкость настроек:
- Индивидуальные настройки для каждого типа
- Управление частотой
- Тихий режим

### Производительность:
- Оптимизированные запросы
- Индексы базы данных
- Пакетная обработка

### Масштабируемость:
- Поддержка разных типов уведомлений
- Различные способы доставки
- Очередь отправки 