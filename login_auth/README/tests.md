# Тесты приложения Login Auth

## Тесты регистрации (test_registration.py)

### PhoneRegistrationTest
Тестируем полный процесс регистрации:

#### 1. Базовая настройка
```python
def setUp(self):
    self.phone = '+79991234567'
    self.password = 'testpass123'
    cache.clear()
```

#### 2. Основной флоу регистрации (`test_phone_registration_flow`)
Проверяем:
- Ввод номера телефона
- Отправку кода подтверждения
- Проверку кода
- Создание пользователя

#### 3. Валидация телефона (`test_invalid_phone_format`)
- Проверка неправильных форматов
- Обработка ошибок валидации

#### 4. Проверка кода (`test_invalid_verification_code`)
- Попытки ввода неверного кода
- Счетчик попыток
- Блокировка после превышения лимита

#### 5. Срок действия кода (`test_verification_code_expiry`)
- Проверка истечения срока
- Обработка просроченных кодов

#### 6. Лимит попыток (`test_max_verification_attempts`)
- Подсчет неудачных попыток
- Блокировка после максимума попыток

## Тесты верификации (test_verification.py)

### SellerVerificationTest
Тестируем процесс верификации продавцов:

#### 1. Полный процесс (`test_seller_verification_flow`)
Проверяем:
- Подачу заявки с документами
- Модерацию заявки
- Одобрение через 48 часов
- Получение статуса продавца

#### 2. Отклонение заявки (`test_verification_rejection`)
- Отклонение модератором
- Указание причины отказа
- Возможность повторной подачи

#### 3. Ранняя верификация (`test_early_verification_approval`)
- Попытка одобрения до 48 часов
- Проверка блокировки раннего одобрения

#### 4. Проверка документов (`test_missing_required_documents`)
- Обязательные документы
- Валидация форматов файлов

## Общие тесты (tests.py)

### AuthenticationTests
Тестируем основной функционал:

#### 1. Вход по телефону (`test_phone_login_success`)
- Отправка номера
- Получение кода
- Успешная авторизация

#### 2. Проверка кода (`test_verify_code_success`)
- Валидация кода
- Создание сессии
- Редирект после входа

#### 3. Повторная отправка (`test_resend_code`)
- Запрос нового кода
- Инвалидация старого кода
- Проверка таймаутов

#### 4. Госуслуги (`test_gosuslugi_auth`)
- Тестирование заглушки
- Проверка создания пользователя
- Верификация статуса

### OneTimeCodeTests
Тесты модели кодов подтверждения:

#### 1. Генерация кода (`test_code_generation`)
- Формат кода
- Уникальность
- Длина кода

#### 2. Срок действия (`test_expiry_check`)
- Проверка истечения
- Валидные коды
- Невалидные коды

#### 3. Блокировка (`test_blocking_after_max_attempts`)
- Подсчет попыток
- Блокировка после лимита

### SMSServiceTests
Тесты отправки SMS:

#### 1. Успешная отправка (`test_successful_sms_send`)
- Интеграция с API
- Проверка ответа
- Логирование

#### 2. Обработка ошибок (`test_failed_sms_send`)
- Неудачные запросы
- Таймауты
- Повторные попытки

## Как запускать тесты

### Все тесты приложения
```bash
python manage.py test login_auth
```

### Тесты регистрации
```bash
python manage.py test login_auth.tests.test_registration
```

### Тесты верификации
```bash
python manage.py test login_auth.tests.test_verification
```

### Конкретный тест
```bash
python manage.py test login_auth.tests.AuthenticationTests.test_phone_login_success
``` 