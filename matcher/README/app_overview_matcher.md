# Обзор приложения Matcher

## Модели

### UserPreferences (Предпочтения пользователя)
Хранит предпочтения пользователя для подбора питомцев:
- Предпочитаемые виды животных и породы
- Диапазон возраста (мин/макс)
- Предпочтения по полу
- Предпочтения по размеру и окрасу
- Специальные требования:
  - Наличие родословной
  - Наличие прививок
  - Наличие ветпаспорта
- Максимальное расстояние для поиска
- Метки времени создания и обновления

### MatchingScore (Оценка совместимости)
Хранит результаты сопоставления пользователей и животных:
- Связь с пользователем и животным
- Оценка совместимости
- Совпавшие критерии в формате JSON
- Время создания
- Оптимизированные индексы для быстрого поиска

### UserInteraction (Взаимодействия пользователя)
Отслеживает взаимодействия пользователей с животными:
- Типы взаимодействий:
  - Просмотр
  - Лайк
  - Дизлайк
  - В избранное
  - Контакт
- Метки времени для каждого взаимодействия
- Оптимизированные индексы для анализа

### RecommendationHistory (История рекомендаций)
Хранит показанные рекомендации:
- Связи с пользователем и животным
- Оценка рекомендации
- Причины рекомендации
- Время показа
- Наличие взаимодействия
- Оптимизация для исторического анализа

## Сервисы

### MatchingService (Сервис подбора)
Умный алгоритм подбора питомцев:

1. Расчет базовой оценки:
- Совпадение вида: +20 баллов
- Совпадение породы: +15 баллов
- Совпадение пола: +10 баллов
- Совпадение возраста: +10 баллов
- Совпадение размера: +5 баллов
- Совпадение окраса: +5 баллов
- Специальные требования: +5 баллов каждое

2. Бонус за расположение:
- Увеличение оценки на основе близости
- Учет максимального расстояния из предпочтений

3. Бонус за взаимодействия:
- Увеличение оценки на основе истории лайков
- Учет предпочтений по похожим видам

### RecommendationService (Сервис рекомендаций)
Умная система рекомендаций:

1. Коллаборативные рекомендации:
- На основе поведения похожих пользователей
- Поиск питомцев, понравившихся похожим пользователям

2. Контентные рекомендации:
- На основе характеристик питомцев
- Использование предыдущих лайков пользователя

3. Смешанные рекомендации:
- Объединение всех типов рекомендаций
- Сортировка по релевантности
- Сохранение истории рекомендаций

## Формы

### UserPreferencesForm (Форма предпочтений)
Форма для настройки параметров подбора:
- Интеграция с Select2 для удобства
- Динамический выбор видов и пород
- Проверка диапазона возраста
- Настройки расстояния
- Чекбоксы для специальных требований
- Подсказки для каждого поля

## Представления

### Основные представления:
1. Обновление предпочтений:
- Форма изменения предпочтений
- Проверка данных и обработка ошибок
- Сообщения об успехе

2. Список совпадений:
- Показ подходящих питомцев
- Пагинация (12 на страницу)
- Сортировка по оценке совместимости

3. Список рекомендаций:
- Показ рекомендованных питомцев
- Пагинация (12 на страницу)
- Смешанные типы рекомендаций

4. Запись взаимодействий:
- AJAX-эндпоинт для взаимодействий
- Проверка типов взаимодействий
- Обработка ошибок

5. История взаимодействий:
- Показ прошлых взаимодействий пользователя
- Пагинация (20 на страницу)
- Сортировка по дате

## Ключевые особенности

### Умный подбор:
- Система оценки совместимости
- Рекомендации с учетом местоположения
- Обучение на основе взаимодействий

### Оптимизация производительности:
- Индексы базы данных
- Массовые операции
- Пагинация
- Кэширование

### Пользовательский опыт:
- Простая настройка предпочтений
- Мгновенная запись взаимодействий
- Полная история действий
- Понятные сообщения 